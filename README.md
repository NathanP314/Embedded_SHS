# Embedded_SHS README
## Introduction
This README file gives a background on how to run the RTOS code, including required software and the actual configuration of timers, I2C, and USART options within the GUI, as well as how to build and debug the program in the STM32CubeIDE.
## RTOS Configuration in STM32CubeMX
Install STM32CubeMX (GUI for configuring the timers/I2C/USART). After adding the Nucleo-F446RE, or equivalent board you are attempting to use, go to the pinout of the microcontroller. Click on PA1 and select GPIO Output. Then, for the user label field, type "RELAY_OUT". While in system core, ensure under SYS that debug mode is selected as Serial Wire. Next, enable I2C1 and USART2 under connectivity. Under I2C1, parameter settings, click on the mode and select Fast Mode, default settings should be fine. Under USART2, enable the mode with Asynchronous, disable hardware flow control. Then, under timers, enable TIM3 by selecting internal clock for clock source. Set the prescaler value to 89 and period to 999. To ensure correct clock speeds, go into the clock configuration tab at the top of the GUI, and type 180 in the HCLK block that attaches to the APB1 Prescaler. This prescaler value should be /4. As a result of these changes, APB1 Timer clocks should be 90 MHz. Now, under NVIC within pinout/configuration and system core, enable the TIM3 global interrupt, I2C1 event interrupt, I2C1 error interrupt, and USART2 global interrupt. Generate the code. Save the project outside of the workspace used in the STM32CubeIDE, otherwise there will be issues trying to open the generated code.
## RTOS Build/Run Instructions
To run the RTOS code, you must install the STM32CubeIDE. First, go to project properties, under C/C++ Build Settings, and general settings, enable sprintf at the bottom. Next, create a debug session, then right click on the project in the directory, debug as STM32 project. It is safer to build the project first, but debugging it will build and then run the code. Once programmed, please leave the STM32CubeIDE open because, in debug mode, it will keep searching for the connection to the STM32 through ST_Link, if the connection is interrupted, UART will not work properly, meaning that the connection to the ESP32 will be disrupted. However, if you are only running the RTOS code, then STM32CubeIDE can be closed.
